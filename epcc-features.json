{
  "_warning": "Feature definitions are IMMUTABLE. Only 'passes' and 'status' fields may be modified. IT IS CATASTROPHIC TO REMOVE OR EDIT FEATURE DEFINITIONS.",
  "_planApproved": true,
  "_planApprovedAt": "2026-02-13T10:30:00Z",
  "project": "HK Task Scheduler V2",
  "created": "2026-02-13T00:00:00Z",
  "lastUpdated": "2026-02-17T00:00:00Z",
  "source": "PRD.md",
  "features": [
    {
      "id": "F001",
      "name": "File Upload",
      "description": "Accept Excel (.xlsx) and CSV (.csv) staff schedule uploads, parse into structured format, validate file structure",
      "priority": "P0",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 1,
      "dependencies": [],
      "estimatedHours": 1,
      "planReference": "EPCC_PLAN.md#phase-1-core-backend",
      "acceptanceCriteria": [
        "App accepts .xlsx and .csv file uploads via Streamlit file uploader",
        "Parsed data contains name, day, shift_name, start_time, end_time fields",
        "Invalid files show clear error message"
      ],
      "subtasks": [
        {"name": "Create prompt.py with get_completion and prompt variables", "status": "completed", "estimatedHours": 1},
        {"name": "Add file uploader and pandas parsing in app.py", "status": "completed", "estimatedHours": 0.5},
        {"name": "Add fallback to bundled staff_schedule.json", "status": "completed", "estimatedHours": 0.5}
      ],
      "source": "PRD.md#must-have-p0"
    },
    {
      "id": "F002",
      "name": "Day Selection",
      "description": "Dropdown to select day of week, filter staff to shift_1 on selected day, show available staff count",
      "priority": "P0",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 2,
      "dependencies": ["F001"],
      "estimatedHours": 0.5,
      "planReference": "EPCC_PLAN.md#phase-1-core-backend",
      "acceptanceCriteria": [
        "Dropdown lists Monday through Sunday",
        "Selecting a day filters staff_schedule to shift_1 entries for that day",
        "Available staff count displayed to user"
      ],
      "subtasks": [
        {"name": "Add day dropdown and shift_1 filtering", "status": "completed", "estimatedHours": 0.5}
      ],
      "source": "PRD.md#must-have-p0"
    },
    {
      "id": "F003",
      "name": "LLM Schedule Generation",
      "description": "Use exact prompt from hk_prompt.ipynb with get_completion() function, call Groq API, parse JSON response",
      "priority": "P0",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 3,
      "dependencies": ["F001", "F002"],
      "estimatedHours": 1,
      "planReference": "EPCC_PLAN.md#phase-2-generation-display",
      "acceptanceCriteria": [
        "Prompt assembled using exact variables from notebook (TASK_CONTEXT, TASK_DESCRIPTION, EXAMPLES, INPUT_DATA, CONSTRAINT, PRECOGNITION, OUTPUT_FORMATTING)",
        "get_completion() function reused/improved with env var API key and error handling",
        "Groq API called with meta-llama/llama-4-scout-17b-16e-instruct model",
        "JSON response parsed into list of employee assignments"
      ],
      "subtasks": [
        {"name": "Wire generate button to prompt assembly and API call", "status": "completed", "estimatedHours": 0.5},
        {"name": "Parse JSON from <response> tags", "status": "completed", "estimatedHours": 0.5}
      ],
      "source": "PRD.md#must-have-p0"
    },
    {
      "id": "F004",
      "name": "Timeline Grid Display",
      "description": "Horizontal Gantt-chart style grid with employee rows, hourly columns (07-14), color-coded task blocks",
      "priority": "P0",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 4,
      "dependencies": ["F003"],
      "estimatedHours": 1.5,
      "planReference": "EPCC_PLAN.md#phase-2-generation-display",
      "acceptanceCriteria": [
        "Each employee displayed as a row with name and shift time",
        "Columns represent hourly slots from 07:00 to 14:00",
        "Task blocks rendered as colored rectangles with task name text",
        "Colors differentiated by category (floors, restrooms, outdoor, egress, BOH, float, break)",
        "Minimalistic design - no images or avatars"
      ],
      "subtasks": [
        {"name": "Build timeline grid HTML/CSS using frontend-design skill", "status": "completed", "estimatedHours": 1.5}
      ],
      "source": "PRD.md#must-have-p0"
    },
    {
      "id": "F005",
      "name": "Constraint Validation Display",
      "description": "Post-generation validation showing pass/fail per constraint rule",
      "priority": "P0",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 5,
      "dependencies": ["F003"],
      "estimatedHours": 0.5,
      "planReference": "EPCC_PLAN.md#phase-2-generation-display",
      "acceptanceCriteria": [
        "Validates no double-booking across simultaneous tasks",
        "Validates Restroom_2 staffing (1-2, 2 from 14:00, max 2h/person)",
        "Validates Restroom_4 staffing (exactly 1, max 2h/person)",
        "Validates Egress (exactly 2, 10:00-12:00 only)",
        "Validates BOH-Breakroom and BOH-Restrooms constraints",
        "Displays clear pass/fail indicators per constraint"
      ],
      "subtasks": [
        {"name": "Write constraint validation functions", "status": "completed", "estimatedHours": 0.5}
      ],
      "source": "PRD.md#must-have-p0"
    },
    {
      "id": "F006",
      "name": "Regenerate Button",
      "description": "Allow re-running schedule generation if result is unsatisfactory",
      "priority": "P1",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 3,
      "dependencies": ["F003"],
      "estimatedHours": 0.25,
      "planReference": "EPCC_PLAN.md#phase-2-generation-display",
      "acceptanceCriteria": [
        "Button visible after schedule is generated",
        "Clicking regenerates with same inputs but fresh LLM call"
      ],
      "subtasks": [],
      "source": "PRD.md#should-have-p1"
    },
    {
      "id": "F007",
      "name": "Schedule Export",
      "description": "Download generated schedule as CSV or printable format",
      "priority": "P1",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-13T11:00:00Z",
      "implementationOrder": 6,
      "dependencies": ["F003"],
      "estimatedHours": 0.5,
      "planReference": "EPCC_PLAN.md#phase-3-polish-test",
      "acceptanceCriteria": [
        "Download button available after schedule generation",
        "Exported file contains all employee assignments with time slots"
      ],
      "subtasks": [
        {"name": "Add CSV download button", "status": "completed", "estimatedHours": 0.5}
      ],
      "source": "PRD.md#should-have-p1"
    },
    {
      "id": "F008",
      "name": "Multi-Shift Staff Filtering",
      "description": "Replace shift_1-only filtering with all-shifts-for-day filtering so shift_2 and shift_3 staff are included in schedule generation",
      "priority": "P0",
      "status": "completed",
      "passes": true,
      "verifiedAt": "2026-02-17T00:00:00Z",
      "implementationOrder": 8,
      "dependencies": ["F002"],
      "estimatedHours": 0.5,
      "planReference": "EPCC_PLAN.md#plan-add-shift-2--shift-3-support",
      "acceptanceCriteria": [
        "filter_by_day() returns all shifts for selected day (not just shift_1)",
        "Sidebar metric shows total staff count across all shifts",
        "All shifts' staff sent to LLM in single call"
      ],
      "subtasks": [
        {"name": "Replace filter_shift1 with filter_by_day in app.py", "status": "completed", "estimatedHours": 0.15},
        {"name": "Update sidebar labels and warning messages", "status": "completed", "estimatedHours": 0.1},
        {"name": "Update test imports and assertions", "status": "completed", "estimatedHours": 0.25}
      ],
      "source": "EPCC_PLAN.md"
    },
    {
      "id": "F009",
      "name": "Full-Day Timeline (07:00-22:00)",
      "description": "Expand timeline grid from 8 columns (07:00-14:00) to 16 columns (07:00-22:00) covering all shifts",
      "priority": "P0",
      "status": "completed",
      "passes": true,
      "verifiedAt": "2026-02-17T00:00:00Z",
      "implementationOrder": 9,
      "dependencies": ["F004"],
      "estimatedHours": 0.25,
      "planReference": "EPCC_PLAN.md#plan-add-shift-2--shift-3-support",
      "acceptanceCriteria": [
        "TIME_SLOTS spans 07:00 through 22:00 (16 columns)",
        "Timeline grid renders all 16 hourly columns",
        "Empty cells show hatched pattern for hours outside staff's shift"
      ],
      "subtasks": [
        {"name": "Expand TIME_SLOTS constant", "status": "completed", "estimatedHours": 0.1},
        {"name": "Verify grid rendering with extended columns", "status": "completed", "estimatedHours": 0.15}
      ],
      "source": "EPCC_PLAN.md"
    },
    {
      "id": "F010",
      "name": "Multi-Shift Constraint Validation",
      "description": "Extend Restroom_2 and Restroom_4 constraint checks to cover full operating hours (10:00-22:00) dynamically",
      "priority": "P0",
      "status": "completed",
      "passes": true,
      "verifiedAt": "2026-02-17T00:00:00Z",
      "implementationOrder": 10,
      "dependencies": ["F005"],
      "estimatedHours": 0.5,
      "planReference": "EPCC_PLAN.md#plan-add-shift-2--shift-3-support",
      "acceptanceCriteria": [
        "Restroom_2 validated across 10:00-22:00 (dynamic from time_map)",
        "Restroom_4 validated across 10:00-22:00 (dynamic from time_map)",
        "Egress and BOH constraints unchanged (shift_1 specific)",
        "Tests pass with multi-shift VALID_ASSIGNMENTS fixture"
      ],
      "subtasks": [
        {"name": "Update Restroom_2 and Restroom_4 time ranges to dynamic", "status": "completed", "estimatedHours": 0.25},
        {"name": "Add shift_2/shift_3 staff to test VALID_ASSIGNMENTS", "status": "completed", "estimatedHours": 0.25}
      ],
      "source": "EPCC_PLAN.md"
    },
    {
      "id": "F011",
      "name": "Prompt Bug Fixes for Multi-Shift",
      "description": "Fix missing comma in EXPECTED_OUTPUT, remove double-encoding via json.dumps on string, increase max_tokens for larger responses",
      "priority": "P0",
      "status": "completed",
      "passes": true,
      "verifiedAt": "2026-02-17T00:00:00Z",
      "implementationOrder": 7,
      "dependencies": ["F003"],
      "estimatedHours": 0.25,
      "planReference": "EPCC_PLAN.md#plan-add-shift-2--shift-3-support",
      "acceptanceCriteria": [
        "Missing comma after '13:00: Outside' fixed in EXPECTED_OUTPUT",
        "json.dumps() removed from EXPECTED_OUTPUT usage in build_prompt()",
        "max_tokens increased from 2000 to 4000"
      ],
      "subtasks": [
        {"name": "Fix missing comma in EXPECTED_OUTPUT", "status": "completed", "estimatedHours": 0.05},
        {"name": "Remove json.dumps wrapping of string EXPECTED_OUTPUT", "status": "completed", "estimatedHours": 0.1},
        {"name": "Increase max_tokens to 4000", "status": "completed", "estimatedHours": 0.05}
      ],
      "source": "EPCC_PLAN.md"
    },
    {
      "id": "F012",
      "name": "LLM Self-Correction via Second Pass",
      "description": "When first LLM response fails constraint validation, automatically send failed schedule + specific failure reasons to a second LLM call (llama-3.3-70b-versatile) to fix mistakes",
      "priority": "P1",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-17T12:00:00Z",
      "implementationOrder": 12,
      "dependencies": ["F003", "F005"],
      "estimatedHours": 1.5,
      "planReference": "EPCC_PLAN.md#plan-llm-self-correction",
      "acceptanceCriteria": [
        "Failed constraints trigger an automatic correction call",
        "Correction prompt includes original schedule + specific failures",
        "UI shows corrected result with validation re-run",
        "If correction also fails, show result as-is (no infinite loop)",
        "Pass 1 uses Maverick model, Pass 2 uses llama-3.3-70b-versatile"
      ],
      "subtasks": [
        {"name": "Add build_correction_prompt() in prompt.py", "status": "completed", "estimatedHours": 0.5},
        {"name": "Add correct_schedule() with model parameter support", "status": "completed", "estimatedHours": 0.25},
        {"name": "Wire correction into app.py generation flow", "status": "completed", "estimatedHours": 0.33},
        {"name": "Add test for correction prompt", "status": "completed", "estimatedHours": 0.25}
      ],
      "source": "EPCC_PLAN.md"
    }
    {
      "id": "F013",
      "name": "PNG Export with Playwright",
      "description": "Export timeline grid as PNG screenshot using Playwright headless browser with full_page=True to avoid clipping",
      "priority": "P1",
      "status": "verified",
      "passes": true,
      "verifiedAt": "2026-02-19T00:00:00Z",
      "implementationOrder": 13,
      "dependencies": ["F004"],
      "estimatedHours": 1,
      "planReference": "EPCC_PLAN.md#plan-png-export-with-playwright",
      "acceptanceCriteria": [
        "Download PNG button available after schedule generation",
        "PNG captures full timeline (07:00-22:00) with no clipping",
        "File named {day}_Schedule.png (e.g., Monday_Schedule.png)",
        "All employee rows, legend, and time headers visible in PNG"
      ],
      "subtasks": [
        {"name": "Replace html2image with Playwright sync API", "status": "completed", "estimatedHours": 0.5},
        {"name": "Update pyproject.toml dependencies", "status": "completed", "estimatedHours": 0.1},
        {"name": "Verify PNG via Playwright MCP", "status": "completed", "estimatedHours": 0.3}
      ],
      "source": "EPCC_PLAN.md"
    }
  ],
  "metrics": {
    "total": 13,
    "verified": 9,
    "completed": 4,
    "inProgress": 0,
    "pending": 0,
    "percentComplete": 100
  }
}
